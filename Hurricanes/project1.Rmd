---
title: 'Project 1: Hurricanes Data'
author: "Cynthia Li 3034939311"
date: "10/8/2021"
output: html_document
---
> ### Learning Objectives
> - Perform an exploratory analysis of tropical storms in the North Atlantic from years 1970 to 2019

## A.1) Recommended R Packages 
```{r setup}
library(tidyverse)
library(lubridate)
library(spData)
library(gganimate)
library(gganimate)
library(png)
library(gifski)
```

## A.2) Importing Data in R
```{r}
col_names <- c(
  "SID",
  "SEASON",
  "NUMBER",
  "BASIN",
  "SUBBASIN",
  "NAME",
  "ISO_TIME",
  "NATURE",
  "LAT",
  "LON",
  "WMO_WIND",
  "WMO_PRES",
  "WMO_AGENCY",
  "TRACK_TYPE",
  "DIST2LAND",
  "LANDFALL"
)

col_types <- c(
  "character",
  "integer",
  "integer",
  "character",
  "character",
  "character",
  "character",
  "character",
  "double",
  "real",
  "integer",
  "integer",
  "character",
  "character",
  "integer",
  "integer"
)

dat <- read.csv(
  file = "ibtracs.NA.list.v04r00.csv",
  colClasses = c(col_types, rep("NULL", 147)),
  stringsAsFactors = FALSE,
  skip = 77876,
  na.strings = c("MM", " ", "NR")
)

colnames(dat) <- col_names
```

## A.3) Adding a MONTH column
```{r}
# Adding month
dat$ISO_TIME = as.POSIXct(dat$ISO_TIME)
dat$MONTH <- lubridate::month(dat$ISO_TIME)
# Display structure of the data
str(dat, vec.len = 1)
```


## B) Univariate Exploratory Data Analysis

## C) Main Analysis
## C.1) Are hurricanes becoming more frequent?
I would like to get a table in which the first represents the year/season and the second column represents the counts of hurricanes in that year. Then I want to draw a line chart to visualize the change from 1970 to 2019.
```{r}
uniq_storm <- distinct(dat, SID, SEASON)
uniq_storm_cnts_per_season <- count(uniq_storm, SEASON)
# Remove the last two rows that represent 2020 and 2021 seasons from the table
uniq_storm_cnts_1970_2019 <- head(uniq_storm_cnts_per_season, -2)
# Display the table
uniq_storm_cnts_1970_2019
# To show the tendency, I choose to draw a line chart
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(data = uniq_storm_cnts_1970_2019) +
  geom_point(aes(x = SEASON, y = n)) +
  geom_line(aes(x = SEASON, y = n)) +
  geom_hline(aes(yintercept = mean(n)), color = "blue") +
  ggtitle("The Number of Storms in Each Season/Year from 1970 to 2019")
```

As we can see from the line chart generated by the table above, the data points which represent the number of hurricanes in a season deviate from the average horizontal line. If the general tendency of the frequency of storms each year is increasing, we would expect the data points in recent years, on the right side of the graph, are above the average horizontal line, while the data points in the left part of the graph are below the average horizontal line. There is a data point that deviates from other points: the maximum counts of hurricanes in a year is 31 in 2005. However, the general tendency reflected by the line chart is still horizontal. Therefore, hurricanes("storms" is a more precise term here) are not becoming more frequent year over year from 1970 to 2019. 

## C.2) Are hurricanes getting stronger?
```{r}
uniq_rows <- distinct(dat, SID, .keep_all = TRUE)
uniq_rows_1970_2019 <- filter(uniq_rows, SEASON <= 2019)
avg_wind_speed_and_pres_per_year <- summarise(
  group_by(uniq_rows_1970_2019, SEASON),
  avg_wind_speed = mean(WMO_WIND, na.rm = TRUE),
  avg_wind_pressure = mean(WMO_PRES, na.rm = TRUE)
)
avg_wind_speed_and_pres_per_year
# Draw the line chart for the avg wind speed per year
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(data = avg_wind_speed_and_pres_per_year) +
  geom_point(aes(x = SEASON, y = avg_wind_speed)) +
  geom_line(aes(x = SEASON, y = avg_wind_speed)) +
  geom_hline(aes(yintercept = mean(avg_wind_speed)), color = "blue")
  ggtitle("The Average Wind Speed of Hurricanes in Each Season/Year from 1970 to 2019")
# Draw the line chart for the avg wind pressure per year
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(data = avg_wind_speed_and_pres_per_year) +
  geom_point(aes(x = SEASON, y = avg_wind_pressure)) +
  geom_line(aes(x = SEASON, y = avg_wind_pressure)) +
  geom_hline(aes(yintercept = mean(avg_wind_pressure)), color = "blue") +
  ggtitle("The Average Wind Pressure of Hurricanes in Each Season/Year from 1970 to 2019")


```

In the first line chart "The Average Wind Speed of Hurricanes in Each Season/Year from 1970 to 2019", we can see the tendency that the average weed speed of each year is increasing from 1970 to 2019. In the second line chart "The Average Wind Pressure of Hurricanes in Each Season/Year from 1970 to 2019", we can see the average wind pressure of hurricanes of each year deviates from the average horizontal line from 1970 to 2020, indicating no tendency of decreasing or increasing. Observing the increasing tendency in wind speed, I conclude that hurricanes are getting stronger year over year from 1970 to 2019.

## C.3) 2019 Atlantic Hurricane Season
Claim a) The 2019 Atlantic hurricane season had 20 tropical cyclones, of which 18 were names storms.

```{r}
# First, get a table recording all unique storms in 2019
uniq_storms_2019 <- distinct(filter(dat, SEASON == 2019), SID, .keep_all = TRUE)
uniq_storms_2019
```

```{r}
# Count the number of rows in this table, so we can know how many storms a.k.a tropical cyclones are there in 2019 Atlantic hurricane season.
nrow(uniq_storms_2019)
```

```{r}
# Among these 20 tropical cyclones in 2019, filter out tropical cyclones that are named.
named_storms_2019 <- filter(uniq_storms_2019, NAME != "NOT_NAMED")
named_storms_2019
# Finally, we can find how many of them are named.
nrow(named_storms_2019)
```

After using filter() and nrow() functions to select distinct storms a.k.a tropical cyclones in 2019 and get the number of rows, we can see that the 2019 Atlantic hurricane season had 20 tropical cyclones, of which 18 were names storms. Claim a) is true.

Claim b) The 2019 Atlantic hurricane season had six named storms that achieved hurricane status.
```{r}
named_storms_2019 <- filter(dat, SEASON == 2019, NAME != "NOT_NAMED")
# Want to find the max sustained wind speed for each storms with unique SID in 2019
max_wind_speed_2019 <- summarise(
  group_by(named_storms_2019, SID),
  max_wind_speed = max(WMO_WIND, na.rm = TRUE),
)
# Display the table to show the max sustained wind speed for each unique storm in 2019
max_wind_speed_2019
# Filter out the table which contains storms with max sustained wind speed greater than or equal to 64 knots
filter(max_wind_speed_2019, max_wind_speed >= 64)
```
There are seven storms that achieved hurricane status, so claim b) is false.

Claim c) The 2019 Atlantic hurricane season had three named storms that intensified into major hurricanes, all of which became Category 5 hurricanes.
```{r}
# Major hurricanes: max sustained wind speed >= 111 mph / 96.4564 knots
filter(max_wind_speed_2019, max_wind_speed >= 96.4564)
# Category 5: max sustained wind speed >= 157 mph / 136.429 knots
filter(max_wind_speed_2019, max_wind_speed >= 136.429)

```

The 2019 Atlantic hurricane season had three named storms that intensified into major hurricanes, two of which became Category 5 hurricanes. Therefore, Claim c) is false. 

Claim d) There was one storm in 2019 that formed outside the official hurricane season (recall that the official season goes from June 1 to November 30).
```{r}
# First, filter the table with storms in Month outside 6:11 in 2019
f1 <- filter(dat, SEASON == 2019, !MONTH %in% 6:11)
f1
# Next, extract each unique storm described by the SID
distinct(f1, SID, .keep_all = TRUE)
```
We can see that there is one storm in 2019 that formed outside the official hurricane season. Therefore, claim d) is true.

Claim e) Two storms became Category 5 hurricanes, at least one storm making landfall at Category 5 intensity.
```{r}
# In c.3) Claim c, we have already create a table which records all named storms in 2019 on line 149
named_storms_2019 <- filter(dat, SEASON == 2019, NAME != "NOT_NAMED")
max_wind_speed_2019 <- summarise(
  group_by(named_storms_2019, SID),
  max_wind_speed = max(WMO_WIND, na.rm = TRUE),
)
max_wind_speed_2019
# On line 167, we have seen that there are two storms that can be characterized by Category 5 hurricanes. So far we know the first part of claim e) is true.
filter(max_wind_speed_2019, max_wind_speed >= 136.429)
# To know whether the second part of claim e) is correct, we want to check whether one of these two Category 5 hurricanes has made a landfall i.e. landfall == 0
two_category_5_hurricanes <- filter(dat, SID == "2019236N10314" | SID == "2019266N11341")
f2 <- filter(two_category_5_hurricanes, LANDFALL == 0)
f2
# Find how many of these two Category 5 are in the table above
distinct(f2, SID)

```
We see that both two of these Category 5 hurricanes in 2019 have made landfalls. Therefore, claim e) is true.

## C.4) Animated Map
First, I plot the locations of the storms with their longitude and latitude on a map.
source: http://www.gastonsanchez.com/intro2cwd/eda-maps.html
```{r}
library(dplyr) # for syntactic manipulation of tables
library(ggplot2) # for making graphs based on tabular data
library(maps) # for drawing basic geographical maps
library(rnaturalearth) # world map data from Natural Earth
```

```{r}
storms2019 <- filter(dat, SEASON == 2019, na.rm = TRUE)
ggplot(data = storms2019, aes(x = LON, y = LAT, color = NAME)) +
  geom_point(alpha = 0.7)
```


```{r}
# Convert the map-object into a data frame, so we can use the map data objects from "map" with "ggplot2".
world_map <- map_data("world")
head(world_map)
```
First, draw the world map.
```{r}
gg_world <- ggplot() + 
  geom_polygon(data = world_map,
               aes(x = long, y = lat, group = group),
               fill = "gray95",
               colour = "gray70",
               size = 0.2) + 
  theme_bw()
```

Next, try to draw the static map of storms on the gg_world map
```{r}
map <- gg_world + 
  geom_point(data = storms2019, aes(x = LON, y = LAT, color = NAME, size = WMO_WIND, alpha = 0.1)) +
  xlim(c(-150, 0)) +
  ylim(c(0, 90))
map
```

Now, draw the animated tracking map.
```{r}
ani <- map +
  labs(title = "Animated Tracking Map, Date: {frame_time}") +
  transition_time(ISO_TIME) +
  shadow_wake(wake_length = 0.1, alpha = FALSE) +
  exit_disappear(early = TRUE)
  
animate(ani, nframes = 300, fps=8)
```

